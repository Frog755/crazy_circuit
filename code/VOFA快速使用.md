# VOFA+ 快速使用指南

## 一、使用步骤

### 1. 硬件连接
- 连接TC264调试串口（UART0，TX: P14_0）到电脑USB转串口
- 串口参数：**115200, 8, N, 1**

### 2. VOFA软件设置
1. 打开VOFA+软件
2. 选择**串口助手**
3. 选择串口号，波特率**115200**
4. **协议：JustFloat**（重要！）
5. 打开串口

### 3. 代码说明
- 代码已在`control()`函数中自动发送波形
- 无需额外配置，编译运行即可

---

## 二、输出的12个变量

| 通道 | 变量 | 说明 | 调参用途 |
|------|------|------|----------|
| [0] | image_error | **图像误差**（-47~+47） | 观察路径偏差 |
| [1] | diff_angle | **角度环输出** | 角度控制响应 |
| [2] | speed_diff | **差速**（角速度环输出） | 差速控制效果 |
| [3] | current_base_speed | 基础速度 | 速度策略 |
| [4] | left_target_speed | **左目标速度** | **速度跟随** |
| [5] | right_target_speed | **右目标速度** | **速度跟随** |
| [6] | left_encoder | **左编码器**（实际速度） | **速度跟随** |
| [7] | right_encoder | **右编码器**（实际速度） | **速度跟随** |
| [8] | pid_L.Err | **左PID误差** | **PID性能** |
| [9] | pid_R.Err | **右PID误差** | **PID性能** |
| [10] | pwm_l | **左PWM输出** | **最终输出** |
| [11] | pwm_r | **右PWM输出** | **最终输出** |

---

## 三、关键调参方法

### 🔥 最重要：速度环PID调参

**观察波形：通道4&6，通道5&7**
- **通道4（左目标速度）vs 通道6（左编码器）**
- **通道5（右目标速度）vs 通道7（右编码器）**

**调参步骤：**

1. **观察跟随性能**
   - 编码器值应该紧跟目标速度
   - 如果滞后 → 增大Kp和Ki

2. **观察误差**
   - 通道8和9（PID误差）应该接近0
   - 如果误差持续存在 → 增大Ki

3. **观察震荡**
   - 如果波形上下波动 → **减小Kp和Ki，增加Kd**

4. **观察超调**
   - 如果超过目标值很多 → 减小Kp，增加Kd

**当前参数位置：** `code/pid.c` 的 `PID_Init()` 函数

---

### 角度环PID调参

**观察波形：通道0&1**
- 通道0（图像误差）→ 通道1（角度输出）

**调参：**
- 响应太慢 → 增大 `angle_pid.Kp`
- 震荡 → 减小Kp，增加Kd

---

### 角速度环PID调参

**观察波形：通道1&2**
- 通道1（角度输出）→ 通道2（差速）

**调参：**
- 差速变化太剧烈 → 减小 `Angular_pid.Kp`
- 不平滑 → 增加Kd

---

## 四、常见问题快速诊断

### 问题：电机抖动/卡顿

**看波形：**
- 通道10和11（PWM）是否正负跳变？
- 通道8和9（PID误差）是否异常大？

**解决：**
- PWM跳变 → 降低Kp和Ki
- 误差大 → 降低Kp和Ki，增加Kd

### 问题：速度跟不上

**看波形：**
- 通道6/7是否明显小于通道4/5？

**解决：**
- 增大Ki（消除稳态误差）
- 增大Kp（加快响应）

### 问题：系统震荡

**看波形：**
- 所有波形是否都在上下波动？

**解决：**
- 降低所有PID的Kp
- 降低Ki
- 增加Kd

---

## 五、推荐观察的波形组合

### 组合1：速度控制（最常用）⭐
```
通道4: left_target_speed
通道6: left_encoder
```
**目的**：观察速度跟随性能

### 组合2：PID性能
```
通道8: pid_L.Err
通道10: pwm_l
```
**目的**：观察PID误差和输出关系

### 组合3：控制链路
```
通道0: image_error
通道1: diff_angle
通道2: speed_diff
```
**目的**：观察整个控制链路

---

## 六、调参顺序

1. **先调速度环**（pid_L, pid_R）
   - 固定目标速度，让编码器稳定跟随
   
2. **再调角度环**（angle_pid）
   - 让角度输出合理响应图像误差
   
3. **最后调角速度环**（Angular_pid）
   - 让差速变化平滑

---

## 七、快速调参技巧

1. **一次只改一个参数**
2. **每次改变±20-50%**
3. **观察10-30秒再决定下一步**
4. **优先保证稳定（不震荡）**
5. **再保证精度（误差小）**

---

详细说明请参考：`code/VOFA调参指南.md`

